# Chapter 3. Pods:running containers in kubernetes

## 3.1 파드 소개
쿠버네티스는 컨테이너를 개별적으로 배포하는 대신 파드로 한번더 감싸서 운영한다. 단일 포드에 둘 이상의 컨테이너를 포함시킬 수 있지만 단일 컨테이너만 포함하는 것이 일반적이다. 파드의 핵심은 파드 안에 포함된 컨테이너들은 항상 단일 워커 노드에서 실행되는 것이다. 아래 그림과 같이 실행되지 않는다.

![image](https://user-images.githubusercontent.com/44857109/105663606-06076800-5f16-11eb-8e53-4b195d6fc868.png)

<br>

### 왜 쿠버네티스는 컨테이너를 직접 사용하지 않고 파드라는 개념을 만들었을까? 

컨테이너는 컨테이너 당 하나의 프로세스만 실행하도록 설계되었다. 단일 컨테이너에서 관련되지 않은 여러 프로세스를 실행하는 경우 각 프로세스를 관리하기 위한 노력(로그 관리, 충돌시 재시작 등)은 모두 개발자의 책임이 되어버린다. 따라서 각 프로세스는 자체 컨테이너에서 실행되어야 한다.

서로 밀접하게 관련된 프로세스를 함께 실행하고 싶을 때 여러 프로세스를 단일 컨테이너로 그룹화하면 안되기 때문에 여러 컨테이너를 함께 관리하기 위한 상위 구조가 필요했고 이런 문제를 파드가 해결한다. 파드를 통해 각 프로세스는 단일 컨테이너에서 실행되는 것처럼 동일한 환경을 제공받으면서 컨테이너로 격리된 상태를 유지할 수 있다.

### 파드에서 컨테이너를 격리하는 수준
쿠버네티스는 컨테이너 그룹을 관리하기 위해서 각 컨테이너가 전부는 아니지만 특정 리소스를 공유해서 완전히 격리되지 않도록 한다. 파드의 모든 컨테이너는 Network, IPC, UTS 네임스페이스에서 실행된다. 최신 버전에서는 PID 네임스페이스를 공유할 수도 있지만 기본적으로 활성화되어 있지 않다. Mount(파일시스템) 네임스페이스는 공유하지 않는다. 컨테이너는 이미지에서 파일시스템을 가져 오기 때문에 기본적으로 각 컨테이너의 파일시스템은 다른 컨테이너와 완전히 격리된다. 

파드의 컨테이너는 동일한 Network 네임스페이스에서 실행되기 때문에 동일한 IP, Port 공간을 공유한다. 또한 localhost를 통해 동일한 파드의 다른 컨테이너와 통신할 수 있다.

### 파드 간 네트워크 구성
쿠버네티스 클러스터의 모든 파드는 단일 평면 공유 네트워크 주소 공간에 있다. 모든 파드는 특정 파드가 어떤 노드에서 실행되는지에 상관 없이 파드에 할당된 IP를 통해서 서로 통신할 수 있다. LAN의 컴퓨터와 동일하게 각 파드는 파드 용으로 설정된 네트워크에서 고유한 IP를 할당받고 해당 IP를 통해서 다른 모든 파드에 접근할 수 있다.


![image](https://user-images.githubusercontent.com/44857109/105666335-5e416880-5f1c-11eb-9e61-bdf35e038032.png)

### 파드에 컨테이너 구성
파드는 비교적 가볍기 때문에 큰 오버 헤드 걱정없이 많은 수의 파드를 가질 수 있다. 따라서 밀접하게 관련된 구성 요소를 제외하고는 모든 것을 파드로 분리시키는 것이 좋다. 

프론트엔드, 백엔드로 구성된 다중 계층 어플리케이션을 파드로 구성하는 예를 생각해보자.

파드는 하나의 머신이라 생각해야 한다. 두 컨테이너가 동일한 파드로 구성된다면 항상 동일한 머신에서 실행된다. 2개의 워커 노드로 구성된 쿠버네티스 클러스터에서 1개의 단일 파드만 있는 경우 하나의 워커 노드는 파드를 할당받지 않기 때문에 리소스를 낭비하게 된다. 

또한 파드는 확장의 기본 단위이다. 쿠버네티스는 개별 컨테이너를 수평적으로 확장하는 대신 파드단위로 확장한다. 만약 2개의 컨테이터를 한 파드로 구성하면 백엔드의 인스턴스를 2개로 확장해야 할 때 프론트엔드도 함께 확장된다. 일반적으로 두 구성요소는 다른 확장 요구 사항이 있기 때문에 개별적으로 확장해야 한다. 따라서 두 컨테이너를 별도의 파드로 구성해야 한다. 

컨테이너를 파드로 그룹화할 때 다음을 고려하면 좋다

- 컨테이너들이 함께 실행되어야 하는가? 아니면 개별 머신에서 실행될 수 있는가?
- 컨테이너들이 서로 밀접하게 연관되어 있는가? 아니면 개별적인 구성 요소인가?
- 컨테이너들이 함께 확장되어야 하는가? 아니면 개별적으로 확장되어야 하는가?

